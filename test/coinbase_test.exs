ExUnit.start()

defmodule CoinbaseTest do
  use ExUnit.Case
  doctest Ipncore
  alias Ipncore.{Block, Chain, Tx, Txo}

  # test constants
  @address_alice <<0, 48, 18, 194, 185, 121, 132, 67, 253, 178, 74, 70, 1, 208, 152, 46, 106, 31,
                   241, 247, 180>>

  @pk_alice <<9, 163, 124, 216, 164, 40, 1, 157, 19, 22, 68, 203, 171, 88, 34, 172, 230, 146, 16,
              135, 31, 210, 139, 144, 70, 231, 26, 175, 129, 162, 188, 208, 245, 46, 86, 169, 93,
              126, 213, 250, 246, 158, 191, 94, 189, 185, 6, 165, 145, 238, 17, 206, 192, 169,
              255, 32, 167, 171, 92, 6, 103, 248, 45, 42, 64, 92, 170, 152, 175, 110, 191, 171,
              128, 234, 201, 10, 79, 87, 32, 241, 231, 192, 239, 221, 103, 157, 225, 98, 80, 20,
              142, 226, 31, 218, 54, 71, 172, 11, 162, 76, 233, 140, 72, 119, 160, 146, 156, 113,
              106, 120, 250, 39, 93, 155, 192, 228, 243, 47, 150, 64, 51, 250, 215, 113, 255, 167,
              30, 38, 140, 220, 177, 41, 150, 128, 65, 142, 211, 0, 84, 98, 65, 97, 214, 54, 52,
              190, 150, 171, 58, 212, 5, 72, 134, 64, 146, 10, 225, 47, 209, 91, 31, 210, 79, 28,
              54, 194, 83, 159, 60, 125, 154, 107, 59, 155, 199, 223, 95, 172, 125, 11, 253, 161,
              202, 7, 53, 92, 131, 15, 3, 131, 116, 212, 25, 227, 22, 148, 245, 82, 48, 241, 119,
              91, 95, 82, 9, 48, 47, 149, 34, 200, 139, 92, 108, 160, 199, 247, 199, 157, 69, 228,
              168, 6, 155, 47, 157, 159, 245, 175, 167, 106, 73, 221, 108, 24, 245, 231, 10, 86,
              230, 189, 218, 255, 134, 191, 141, 142, 67, 92, 249, 59, 52, 204, 243, 0, 168, 115,
              59, 233, 234, 245, 105, 53, 85, 187, 159, 38, 83, 49, 200, 37, 82, 55, 35, 35, 14,
              37, 19, 120, 220, 208, 225, 101, 100, 12, 16, 222, 37, 251, 173, 138, 91, 164, 22,
              135, 245, 119, 48, 68, 37, 68, 100, 244, 33, 58, 214, 187, 125, 141, 38, 140, 142,
              171, 227, 36, 110, 224, 153, 124, 224, 129, 203, 5, 18, 33, 213, 83, 71, 101, 238,
              199, 118, 73, 46, 162, 227, 234, 228, 7, 206, 58, 38, 49, 21, 206, 114, 30, 210,
              245, 115, 15, 70, 113, 190, 61, 216, 78, 144, 164, 169, 172, 13, 40, 66, 158, 221,
              153, 204, 203, 208, 96, 36, 48, 38, 1, 154, 48, 171, 29, 167, 1, 225, 173, 58, 84,
              211, 14, 110, 46, 41, 149, 105, 30, 111, 176, 154, 231, 37, 204, 134, 211, 53, 17,
              7, 247, 77, 217, 233, 4, 32, 215, 117, 97, 146, 149, 60, 212, 169, 150, 57, 46, 32,
              76, 149, 252, 51, 255, 79, 214, 125, 5, 51, 103, 230, 220, 86, 18, 237, 90, 203,
              199, 27, 121, 160, 134, 245, 168, 2, 21, 61, 6, 10, 136, 240, 184, 81, 14, 29, 14,
              240, 32, 108, 91, 58, 146, 201, 48, 240, 60, 194, 62, 94, 129, 215, 117, 48, 36,
              221, 9, 165, 51, 6, 10, 11, 240, 73, 190, 248, 68, 73, 47, 175, 189, 9, 131, 53, 70,
              106, 130, 31, 221, 49, 181, 123, 207, 221, 106, 5, 247, 201, 101, 92, 33, 22, 0, 76,
              200, 50, 239, 119, 70, 60, 45, 67, 90, 76, 137, 4, 132, 172, 163, 132, 171, 24, 156,
              248, 23, 41, 90, 233, 79, 53, 73, 202, 168, 107, 0, 227, 179, 104, 79, 120, 252,
              169, 205, 66, 18, 227, 68, 237, 28, 132, 34, 54, 214, 90, 125, 47, 86, 27, 28, 140,
              216, 249, 64, 79, 187, 198, 66, 86, 41, 197, 209, 12, 14, 169, 133, 214, 80, 3, 190,
              170, 15, 169, 210, 108, 53, 83, 177, 209, 167, 218, 35, 109, 86, 212, 200, 49, 99,
              1, 50, 78, 120, 46, 208, 189, 88, 12, 70, 112, 13, 251, 165, 222, 181, 103, 52, 231,
              210, 141, 3, 73, 70, 173, 223, 228, 191, 73, 108, 87, 81, 210, 101, 142, 174, 226,
              0, 158, 144, 7, 47, 198, 166, 114, 102, 166, 177, 86, 66, 24, 59, 98, 224, 38, 37,
              79, 138, 172, 96, 104, 41, 66, 84, 101, 18, 134, 251, 34, 255, 239, 120, 54, 8, 154,
              1, 184, 8, 30, 171, 52, 109, 84, 120, 43, 246, 60, 56, 69, 96, 136, 136, 49, 48,
              188, 106, 123, 83, 225, 65, 156, 50, 226, 184, 49, 79, 44, 43, 118, 144, 59, 96, 67,
              148, 109, 253, 154, 194, 165, 110, 50, 127, 214, 237, 105, 107, 156, 77, 54, 209,
              53, 227, 43, 141, 5, 77, 226, 142, 235, 200, 73, 193, 65, 129, 81, 154, 205, 159,
              237, 8, 134, 246, 167, 129, 36, 229, 22, 226, 155, 3, 20, 200, 116, 131, 82, 125,
              107, 199, 103, 132, 98, 77, 86, 134, 32, 94, 161, 53, 100, 123, 163, 195, 218, 150,
              73, 16, 112, 165, 204, 155, 222, 162, 114, 13, 241, 35, 200, 143, 50, 62, 174, 139,
              241, 215, 161, 117, 8, 98, 3, 173, 135, 232, 115, 192, 206, 3, 226, 20, 66, 90, 161,
              49, 148, 70, 68, 181, 144, 169, 244, 181, 82, 208, 123, 121, 2, 69, 231, 122, 106,
              80, 66, 61, 254, 117, 243, 158, 62, 25, 212, 74, 138, 24, 36, 226, 177, 53, 246, 25,
              48, 80, 32, 155, 240, 181, 250, 79, 214, 166, 20, 64, 51, 36, 65, 31, 81, 189, 49,
              148, 121, 207, 133, 111, 27, 234, 45, 33, 84, 174, 103>>

  @sk_alice <<89, 244, 32, 69, 27, 163, 63, 231, 208, 0, 3, 224, 136, 23, 254, 201, 11, 222, 136,
              252, 33, 64, 16, 0, 129, 247, 191, 189, 248, 63, 5, 247, 209, 61, 244, 48, 65, 236,
              111, 254, 3, 225, 4, 231, 207, 126, 251, 194, 188, 15, 207, 251, 11, 222, 196, 7,
              176, 129, 247, 175, 188, 19, 239, 1, 215, 255, 132, 239, 208, 8, 39, 207, 188, 0,
              48, 72, 239, 222, 60, 243, 240, 1, 235, 114, 186, 252, 79, 254, 252, 0, 61, 240,
              111, 60, 8, 33, 193, 244, 31, 130, 231, 206, 62, 248, 65, 190, 11, 159, 124, 251,
              225, 193, 0, 0, 126, 0, 48, 187, 240, 97, 198, 15, 224, 2, 8, 31, 190, 251, 240, 63,
              0, 47, 123, 35, 224, 0, 244, 32, 63, 8, 47, 134, 239, 240, 252, 216, 31, 128, 243,
              129, 195, 247, 239, 194, 15, 207, 188, 255, 240, 57, 244, 33, 196, 31, 162, 253,
              248, 110, 1, 231, 208, 1, 239, 223, 2, 4, 143, 133, 239, 207, 125, 8, 48, 60, 0, 79,
              200, 252, 48, 1, 236, 15, 195, 231, 240, 196, 11, 177, 4, 251, 176, 134, 248, 94, 3,
              255, 224, 3, 228, 15, 125, 255, 255, 132, 255, 223, 125, 15, 225, 63, 236, 15, 66,
              12, 65, 134, 228, 0, 253, 232, 32, 187, 23, 223, 3, 27, 160, 137, 8, 45, 254, 243,
              223, 188, 3, 175, 65, 7, 144, 4, 19, 207, 135, 16, 96, 252, 240, 127, 252, 16, 49,
              2, 23, 239, 131, 0, 0, 197, 248, 145, 58, 228, 15, 61, 0, 48, 65, 247, 208, 193, 16,
              0, 0, 16, 96, 1, 251, 239, 0, 3, 192, 127, 235, 144, 249, 7, 176, 0, 19, 223, 199,
              248, 63, 254, 243, 193, 126, 3, 207, 62, 8, 96, 66, 4, 47, 132, 3, 238, 134, 23,
              192, 64, 3, 222, 193, 247, 255, 123, 16, 63, 129, 12, 63, 254, 4, 47, 122, 15, 223,
              123, 12, 65, 7, 7, 193, 2, 240, 16, 189, 12, 1, 4, 251, 225, 0, 220, 33, 63, 0, 64,
              193, 248, 16, 121, 235, 224, 192, 12, 31, 123, 248, 0, 190, 248, 33, 121, 252, 160,
              193, 3, 192, 132, 252, 31, 61, 11, 177, 66, 11, 159, 124, 15, 209, 255, 239, 205,
              196, 0, 32, 62, 11, 177, 124, 244, 158, 62, 248, 128, 123, 4, 30, 190, 224, 95, 133,
              235, 239, 128, 3, 241, 125, 248, 64, 125, 244, 2, 61, 0, 31, 252, 12, 0, 8, 19, 240,
              251, 7, 224, 196, 255, 240, 187, 0, 32, 63, 28, 16, 123, 4, 2, 250, 7, 176, 67, 235,
              240, 126, 235, 241, 127, 0, 31, 251, 4, 97, 65, 224, 80, 2, 244, 96, 251, 0, 31,
              187, 252, 15, 132, 20, 48, 127, 247, 222, 252, 12, 18, 59, 240, 0, 136, 19, 240, 64,
              15, 191, 186, 23, 240, 3, 244, 17, 142, 248, 32, 3, 12, 0, 64, 244, 80, 191, 28, 64,
              192, 3, 192, 66, 252, 95, 192, 244, 33, 198, 19, 240, 188, 236, 97, 0, 240, 15, 133,
              0, 79, 130, 27, 240, 131, 255, 224, 180, 255, 240, 185, 243, 238, 193, 19, 255, 189,
              232, 64, 66, 24, 48, 127, 11, 223, 2, 0, 95, 255, 39, 239, 187, 240, 1, 8, 8, 93,
              64, 16, 145, 1, 252, 33, 63, 23, 176, 65, 224, 15, 252, 235, 222, 127, 232, 31, 125,
              12, 33, 66, 244, 80, 191, 255, 144, 130, 244, 79, 129, 240, 99, 190, 243, 189, 195,
              3, 190, 251, 236, 78, 1, 4, 18, 66, 11, 128, 0, 11, 255, 191, 255, 160, 255, 251,
              240, 63, 0, 29, 131, 3, 239, 187, 31, 223, 130, 8, 80, 124, 224, 32, 61, 8, 112,
              197, 235, 223, 129, 0, 31, 125, 248, 15, 62, 219, 222, 190, 251, 224, 2, 4, 80, 1,
              239, 240, 115, 4, 48, 61, 15, 159, 130, 4, 32, 193, 3, 239, 195, 232, 46, 255, 11,
              159, 136, 7, 210, 0, 255, 208, 66, 3, 239, 190, 247, 223, 197, 11, 238, 67, 19, 208,
              129, 32, 95, 192, 236, 111, 193, 232, 129, 0, 248, 48, 64, 16, 47, 134, 28, 111,
              254, 231, 191, 69, 255, 176, 127, 236, 15, 253, 252, 65, 128, 11, 128, 185, 4, 31,
              65, 0, 34, 64, 8, 63, 187, 240, 48, 1, 247, 242, 59, 8, 111, 54, 0, 64, 65, 4, 0,
              61, 252, 16, 253, 252, 33, 136, 252, 14, 125, 202, 239, 193, 2, 48, 3, 29, 254, 3,
              7, 6, 37, 227, 214, 254, 225, 28, 26, 8, 241, 16, 255, 241, 39, 8, 2, 8, 223, 34, 6,
              0, 32, 214, 8, 244, 252, 245, 7, 234, 25, 43, 11, 10, 254, 228, 229, 252, 226, 240,
              248, 26, 11, 236, 4, 255, 252, 31, 16, 254, 14, 4, 4, 6, 249, 237, 223, 25, 0, 230,
              248, 43, 9, 35, 8, 231, 244, 23, 220, 17, 25, 215, 247, 18, 20, 234, 239, 34, 5, 42,
              215, 243, 26, 232, 68, 214, 39, 37, 41, 206, 210, 218, 19, 249, 247, 227, 246, 19,
              254, 219, 230, 27, 247, 229, 12, 18, 236, 4, 14, 45, 24, 222, 226, 3, 223, 3, 46,
              242, 45, 44, 233, 229, 204, 245, 215, 6, 239, 244, 10, 0, 14, 242, 223, 239, 60, 0,
              254, 216, 215, 247, 3, 25, 246, 20, 22, 27, 10, 239, 24, 228, 255, 41, 0, 245, 2,
              239, 247, 230, 253, 243, 248, 21, 5, 6, 18, 252, 255, 232, 253, 233, 22, 25, 249,
              13, 31, 25, 230, 229, 30, 4, 230, 9, 231, 236, 247, 230, 9, 9, 235, 189, 7, 242, 21,
              7, 35, 22, 14, 215, 235, 1, 251, 10, 213, 32, 222, 228, 230, 230, 2, 29, 12, 240,
              250, 37, 14, 230, 1, 52, 0, 4, 21, 1, 215, 19, 233, 24, 0, 255, 21, 11, 37, 223, 25,
              229, 20, 225, 22, 219, 251, 235, 254, 251, 245, 11, 249, 228, 1, 207, 232, 250, 243,
              244, 249, 22, 252, 21, 246, 17, 5, 0, 20, 14, 48, 1, 221, 12, 22, 9, 22, 3, 66, 235,
              21, 240, 26, 16, 15, 36, 224, 26, 12, 18, 20, 0, 8, 49, 216, 35, 221, 213, 246, 255,
              21, 18, 239, 237, 6, 6, 233, 243, 14, 23, 244, 232, 29, 255, 243, 17, 213, 215, 218,
              6, 22, 248, 229, 2, 6, 53, 0, 239, 17, 247, 9, 11, 20, 7, 20, 3, 8, 11, 247, 208,
              41, 223, 245, 241, 251, 227, 5, 243, 240, 14, 237, 246, 239, 209, 40, 40, 28, 17, 5,
              26, 6, 0, 206, 234, 238, 18, 224, 28, 224, 246, 24, 29, 33, 212, 252, 205, 0, 241,
              20, 9, 209, 238, 187, 251, 207, 3, 37, 49, 19, 196, 43, 232, 26, 244, 243, 6, 8, 1,
              219, 26, 222, 9, 9, 255, 5, 0, 231, 28, 227, 238, 234, 250, 239, 233, 253, 240, 3,
              10, 18, 207, 8, 252, 26, 235, 225, 208, 35, 18, 168, 3, 240, 5, 245, 252, 29, 237,
              218, 216, 2, 224, 196, 4, 39, 18, 236, 20, 235, 239, 239, 216, 217, 235, 228, 211,
              51, 254, 240, 252, 45, 15, 230, 10, 254, 241, 220, 6, 42, 15, 245, 238, 0, 244, 6,
              20, 240, 186, 19, 246, 20, 254, 10, 42, 14, 173, 250, 7, 250, 29, 25, 239, 25, 25,
              227, 222, 252, 208, 208, 31, 89, 10, 12, 32, 243, 218, 11, 248, 221, 3, 19, 222,
              245>>

  # @channel Application.get_env(:ipncore, :channel)
  # @token Application.get_env(:ipncore, :token)

  test "block genesis" do
    outputs = [
      %Txo{
        address: @address_alice,
        tid: Default.token(),
        value: 100_000
      },
      %Txo{
        address: @address_alice,
        tid: Default.token(),
        value: 50_000
      }
    ]

    {tx, fixed_outputs} = Tx.new(0, outputs, 150_000)
    prev_block = Chain.prev_block()
    block = Block.next(prev_block, [tx])

    Chain.add_block(block, prev_block, [tx], fixed_outputs, @channel)
  end
end
